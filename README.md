# metrics-collector
Репозиторий для практического трека «Go в DevOps»: реализация сбора (агент) и хранения (сервер) метрик.

## Задания
1. [Инкремент 1 (агент)](./docs/tasks/increment1.md)
2. [Инкремент 2 (сервер)](./docs/tasks/increment2.md)
3. [Инкремент 3 (web framework)](./docs/tasks/increment3.md)
4. [Инкремент 4 (JSON API)](./docs/tasks/increment4.md)
5. [Инкремент 5 (переменные окружения)](./docs/tasks/increment5.md)
6. [Инкремент 6 (сохранение данных на диск)](./docs/tasks/increment6.md)
7. [Инкремент 7 (флаги командной строки)](./docs/tasks/increment7.md)

## Разработка и тестирование
Для получения списка доступных команд выполните следующую команду:
```bash
make help
```

## Запуск сервера
Для запуска сервера, отвечающего за агрегирование и хранение метрик, выполните команду:
```bash
./cmd/server/server
```

### Настройка и значения по умолчанию
#### Опции командной строки
Для вывода списка доступных опций и их значений по умолчанию выполните команду:
```bash
./cmd/agent/agent --help
```

#### Переменные окружения
(!) Переменные окружения имеют приоритет перед опциями командной строки.
```bash
# Адрес и порт сервера, агрегирующего метрики:
export ADDRESS=0.0.0.0:8080

# Интервал опроса метрик (в секундах):
export POLL_INTERVAL=2s

# Интервал отправки метрик (в секундах):
export REPORT_INTERVAL=10s
```

```bash
# Адрес и порт, по которым доступно API сервера:
export ADDRESS=0.0.0.0:8080

# Интервал времени в секундах, по истечении которого текущие показания
# сервера сбрасываются на диск (значение 0 — делает запись синхронной):
export STORE_INTERVAL=300s

# Имя файла, где хранятся значения метрик.
# Пустое значение — отключает функцию записи на диск:
export STORE_FILE="/tmp/devops-metrics-db.json"

# Загружать или нет сохраненные значения метрик из файла при старте сервера:
export RESTORE=true
```

## Запуск агента
Для запуска агента, отвечающего за сбор и отправку метрик, выполните команду:
```bash
./cmd/agent/agent
```

### Настройка и значения по умолчанию
#### Опции командной строки
Для вывода списка доступных опций и их значений по умолчанию выполните команду:
```bash
./cmd/agent/agent --help
```

#### Переменные окружения
(!) Переменные окружения имеют приоритет перед опциями командной строки.
```bash
# Адрес и порт сервера, агрегирующего метрики:
export ADDRESS=0.0.0.0:8080

# Интервал опроса метрик (в секундах):
export POLL_INTERVAL=2s

# Интервал отправки метрик (в секундах):
export REPORT_INTERVAL=10s
```

## Обновление шаблона
Чтобы получать обновления автотестов и других частей шаблона, выполните следующую команду:
```
git remote add -m main template https://github.com/yandex-praktikum/go-musthave-devops-tpl.git
```

Для обновления кода автотестов выполните команду:
```
git fetch template && git checkout template/main .github
```
